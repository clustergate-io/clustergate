apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: preflightprofiles.preflight.platform.io
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
spec:
  group: preflight.platform.io
  names:
    kind: PreflightProfile
    listKind: PreflightProfileList
    plural: preflightprofiles
    singular: preflightprofile
    shortNames:
      - pp
  scope: Cluster
  versions:
    - name: v1alpha1
      served: true
      storage: true
      additionalPrinterColumns:
        - name: Checks
          type: integer
          jsonPath: .status.checkCount
        - name: Valid
          type: boolean
          jsonPath: .status.valid
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          description: PreflightProfile defines a reusable bundle of readiness checks.
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              description: PreflightProfileSpec defines a reusable bundle of readiness checks.
              required:
                - checks
              properties:
                description:
                  type: string
                  description: Human-readable summary of what this profile covers.
                checks:
                  type: array
                  description: List of check references included in this profile.
                  minItems: 1
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        description: >-
                          Identifier for a built-in check (e.g. "dns").
                          Mutually exclusive with preflightCheckRef.
                      preflightCheckRef:
                        type: string
                        description: >-
                          References a PreflightCheck CR by metadata.name.
                          Mutually exclusive with name.
                      severity:
                        type: string
                        description: Overrides the check's default severity.
                        enum:
                          - critical
                          - warning
                          - info
                      category:
                        type: string
                        description: Overrides the check's default category.
                      interval:
                        type: string
                        description: >-
                          Overrides the default interval for this check.
                          Accepts duration strings like "10s", "5m".
                      enabled:
                        type: boolean
                        description: Whether this check is active. Defaults to true.
                      config:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                        description: Check-specific configuration. Only for built-in checks.
            status:
              type: object
              description: PreflightProfileStatus reports the observed state.
              properties:
                valid:
                  type: boolean
                  description: Whether all referenced checks exist and the profile is well-formed.
                checkCount:
                  type: integer
                  description: Number of checks included in this profile.
                message:
                  type: string
                  description: Describes the validation result.
                conditions:
                  type: array
                  description: Standard Kubernetes conditions.
                  items:
                    type: object
                    required:
                      - type
                      - status
                      - lastTransitionTime
                      - reason
                      - message
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
